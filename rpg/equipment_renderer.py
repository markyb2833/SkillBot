import discord
from PIL import Image
import io
from .pixel_art import create_pixel_art, pattern_to_base64

# Equipment patterns and colors (20x20)
EQUIPMENT_PATTERNS = {
    # Swords
    "sword_basic": [
        0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,
    ],
    
    "sword_flame": [
        0,0,0,0,0,0,6,6,2,2,6,6,0,0,0,0,0,0,0,0,
        0,0,0,0,0,6,6,2,1,1,2,6,6,0,0,0,0,0,0,0,
        0,0,0,0,6,6,7,2,1,1,2,7,6,6,0,0,0,0,0,0,
        0,0,0,0,0,6,7,2,1,1,2,7,6,0,0,0,0,0,0,0,
        0,0,0,0,0,0,7,2,1,1,2,7,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,
    ],
    
    # Daggers
    "dagger": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    # Shields
    "shield": [
        0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,
        0,0,0,3,3,3,4,4,4,4,4,4,4,4,3,3,3,0,0,0,
        0,0,3,3,1,1,2,2,2,2,2,2,2,2,1,1,3,3,0,0,
        0,3,3,1,1,2,2,2,2,2,2,2,2,2,2,1,1,3,3,0,
        0,3,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,3,0,
        3,3,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,3,
        3,4,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,4,3,
        3,4,2,2,2,2,2,2,5,5,5,5,2,2,2,2,2,2,4,3,
        3,4,2,2,2,2,2,5,5,5,5,5,5,2,2,2,2,2,4,3,
        3,4,2,2,2,2,2,5,5,5,5,5,5,2,2,2,2,2,4,3,
        3,4,2,2,2,2,2,5,5,5,5,5,5,2,2,2,2,2,4,3,
        3,4,2,2,2,2,2,5,5,5,5,5,5,2,2,2,2,2,4,3,
        3,4,2,2,2,2,2,2,5,5,5,5,2,2,2,2,2,2,4,3,
        3,4,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,4,3,
        0,3,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,3,0,
        0,3,3,1,1,2,2,2,2,2,2,2,2,2,2,1,1,3,3,0,
        0,0,3,3,1,1,2,2,2,2,2,2,2,2,1,1,3,3,0,0,
        0,0,0,3,3,3,1,1,2,2,2,2,1,1,3,3,3,0,0,0,
        0,0,0,0,0,3,3,3,1,1,1,1,3,3,3,0,0,0,0,0,
        0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,
    ],
    
    # Staff
    "staff": [
        0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,5,5,5,4,4,5,5,5,0,0,0,0,0,0,0,
        0,0,0,0,5,5,4,4,4,4,4,4,5,5,0,0,0,0,0,0,
        0,0,0,5,5,4,4,4,4,4,4,4,4,5,5,0,0,0,0,0,
        0,0,0,0,5,5,4,4,4,4,4,4,5,5,0,0,0,0,0,0,
        0,0,0,0,0,5,5,4,4,4,4,5,5,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,
    ],
    
    # Wand
    "wand": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,5,4,5,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,2,2,2,2,2,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    # Helmet
    "helmet": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
        0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        0,1,2,2,3,3,2,2,2,2,2,2,2,2,3,3,2,2,1,0,
        1,1,2,3,3,3,3,2,2,2,2,2,2,3,3,3,3,2,1,1,
        1,2,2,3,3,3,3,2,2,2,2,2,2,3,3,3,3,2,2,1,
        1,2,2,2,3,3,2,2,2,2,2,2,2,2,3,3,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        0,0,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,0,0,
        0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    # Ring
    "ring": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
        0,0,0,0,1,1,2,2,2,2,2,2,2,2,1,1,0,0,0,0,
        0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,
        0,0,0,1,2,2,0,0,0,0,0,0,0,0,2,2,1,0,0,0,
        0,0,0,1,2,0,0,0,0,4,4,0,0,0,0,2,1,0,0,0,
        0,0,0,1,2,0,0,0,4,4,5,4,0,0,0,2,1,0,0,0,
        0,0,0,1,2,0,0,0,4,5,4,4,0,0,0,2,1,0,0,0,
        0,0,0,1,2,0,0,0,0,4,4,0,0,0,0,2,1,0,0,0,
        0,0,0,1,2,2,0,0,0,0,0,0,0,0,2,2,1,0,0,0,
        0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,
        0,0,0,0,1,1,3,3,3,3,3,3,3,3,1,1,0,0,0,0,
        0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    # Armor pieces
    "armor_torso": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
        0,0,0,1,1,1,2,2,2,2,2,2,2,2,1,1,1,0,0,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,0,0,1,1,1,2,2,2,2,2,2,2,2,1,1,1,0,0,0,
        0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    "boots": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
        0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
    
    "gloves": [
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
        0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,
        1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,
        0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
        0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    ],
}

# Color palettes by rarity (20x20 patterns)
RARITY_COLORS = {
    "common": {
        0: (0, 0, 0, 0),        # Transparent
        1: (139, 139, 139),     # Gray base
        2: (169, 169, 169),     # Gray highlight
        3: (101, 67, 33),       # Brown
        4: (160, 160, 160),     # Light gray
        5: (255, 255, 255),     # White
        6: (255, 69, 0),        # Orange flame
        7: (255, 140, 0),       # Dark orange flame
    },
    "uncommon": {
        0: (0, 0, 0, 0),        # Transparent
        1: (34, 139, 34),       # Forest green base
        2: (50, 205, 50),       # Green highlight
        3: (101, 67, 33),       # Brown
        4: (144, 238, 144),     # Light green
        5: (0, 255, 0),         # Bright green
        6: (0, 255, 127),       # Spring green flame
        7: (46, 139, 87),       # Sea green flame
    },
    "rare": {
        0: (0, 0, 0, 0),        # Transparent
        1: (0, 100, 200),       # Blue base
        2: (100, 149, 237),     # Blue highlight
        3: (101, 67, 33),       # Brown
        4: (173, 216, 230),     # Light blue
        5: (0, 191, 255),       # Deep sky blue
        6: (30, 144, 255),      # Dodger blue flame
        7: (0, 206, 209),       # Dark turquoise flame
    },
    "epic": {
        0: (0, 0, 0, 0),        # Transparent
        1: (128, 0, 128),       # Purple base
        2: (147, 112, 219),     # Purple highlight
        3: (101, 67, 33),       # Brown
        4: (221, 160, 221),     # Plum
        5: (138, 43, 226),      # Blue violet
        6: (186, 85, 211),      # Medium orchid flame
        7: (148, 0, 211),       # Dark violet flame
    },
    "legendary": {
        0: (0, 0, 0, 0),        # Transparent
        1: (255, 140, 0),       # Orange base
        2: (255, 165, 0),       # Orange highlight
        3: (101, 67, 33),       # Brown
        4: (255, 215, 0),       # Gold
        5: (255, 69, 0),        # Red orange
        6: (255, 20, 147),      # Deep pink flame
        7: (255, 105, 180),     # Hot pink flame
    },
    "mythic": {
        0: (0, 0, 0, 0),        # Transparent
        1: (255, 215, 0),       # Gold base
        2: (255, 255, 224),     # Gold highlight
        3: (101, 67, 33),       # Brown
        4: (255, 255, 255),     # White
        5: (255, 20, 147),      # Deep pink
        6: (255, 215, 0),       # Gold flame
        7: (255, 255, 0),       # Yellow flame
    }
}

def get_equipment_pattern(equipment_type, subtype):
    """Get the appropriate pattern for equipment type"""
    if subtype == "sword":
        if "flame" in equipment_type.lower() or "fire" in equipment_type.lower():
            return "sword_flame"
        return "sword_basic"
    elif subtype == "dagger":
        return "dagger"
    elif subtype == "shield":
        return "shield"
    elif subtype == "staff":
        return "staff"
    elif subtype == "wand":
        return "wand"
    elif subtype == "head":
        return "helmet"
    elif subtype == "torso":
        return "armor_torso"
    elif subtype == "feet":
        return "boots"
    elif subtype == "gloves":
        return "gloves"
    elif subtype == "ring":
        return "ring"
    else:
        return "sword_basic"  # Default

def create_equipment_image(equipment_data):
    """
    Create a pixel art image for equipment
    
    Args:
        equipment_data: Dictionary with equipment info including bitmap and rarity
    
    Returns:
        PIL Image object
    """
    # Use the bitmap from the equipment data if available
    if 'bitmap' in equipment_data:
        pattern = equipment_data['bitmap']
    else:
        # Fallback to old pattern system
        pattern_key = get_equipment_pattern(equipment_data["name"], equipment_data["subtype"])
        pattern = EQUIPMENT_PATTERNS.get(pattern_key, EQUIPMENT_PATTERNS["sword_basic"])
    
    rarity = equipment_data.get("rarity", "common")
    colors = [RARITY_COLORS[rarity][i] for i in range(8)]  # Support up to 8 colors
    
    return create_pixel_art(pattern, colors)

def create_equipment_file(equipment_data, scale=12):
    """
    Create a Discord file object with the equipment image
    
    Args:
        equipment_data: Equipment dictionary
        scale: Scale factor for the image
    
    Returns:
        discord.File object
    """
    img = create_equipment_image(equipment_data)
    scaled_img = img.resize((20 * scale, 20 * scale), Image.NEAREST)
    
    # Convert to bytes
    buffer = io.BytesIO()
    scaled_img.save(buffer, format='PNG')
    buffer.seek(0)
    
    filename = f"{equipment_data['name'].lower().replace(' ', '_')}.png"
    return discord.File(buffer, filename=filename)